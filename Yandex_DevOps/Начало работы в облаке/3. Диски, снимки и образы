### Диски. Зависимость производительности от объема

**Репликация** - это когда для каждого снимка и образа создается полная копия

Для ВМ могут использоваться сетевые диски:

- HDD
  hard disk drive - накопитель на жестком магнитном диске. Низкая стоимость гигабайта,  скорость ниже чем у SSD. 

  > Они выбираются там, где скорость загрузки не критична (загрузочный диск)

- SSD
  solid state disk - твердотельный накопитель. Позволяет выполнять больше операций считывания и записи в единицу времени. 

  > Используются если нужно часто обращаться к файлам, быстро загружать тяжелые приложения (можно к примеру хранить БД)

**Загрузочные и дополнительные диски**

- Загрузочный - на нем находится ОС и приложения. Он не отключается от ВМ
- Дополнительный - можно хранить любые данные. Его можно отключить от ВМ

> Например есть веб-сервис с возможностью выгрузки данных, то само веб-приложение будет поверх операционной системы на загрузочном диске, а база данных и файлы выгрузки на дополнительных дисках

### Что такое снимок

> На ВМ есть данные, с которыми работает приложение - чтобы их не потерять нужно создавать резервные копии , для этого и придуманы снимки.

Снимок - слепок или поблочная копия дискового устройства на определенный момент времени. (как коммит в гите, к нему можно откатиться)

> Перед тем как делать снимок, нужно останавливать работу ВМ поскольку могут записаться не все файлы

Разница репликации диска и снимка: диск находится в одной зоне доступности и реплицируется только в ней. Снимки же реплицируется во все зоны доступности.

> По этому, чтобы перенести ВМ в другую зону, достаточно создать в этой зоне копию ВМ из снимка загрузочного диска.

### Создание снимка

Для того чтобы создать снимок необходимо обеспечить целостность данных, для этого:

1. Подключиться к ВМ через SSH (ssh имя@ip)
2. Ввести : `sync` (ничего не произойдет)
3. Ввести:  `df -h` (это выдаст файлы, нужен / потому что это корневая папка в линуксе (нужная точка монтирования))
4. Для заморозки файловой системы:
    `fsfreeze -f <точка монтирования>`

> Чтобы проверить заморожена ли файловая система достаточно ввести sudo fsfreeze --freeze <точка монтирования> и если она заморожена то выдаст ответ что ресурс занят

**Намеренное повреждение системы** 

Точно так же в подключенном интерфейсе к ВМ через ssh выполяем последовательно команды:

1. `apt-get update`
2. `apt-get dist-upgrade`
3. Имитация повреждения системы: `sudo rm -rf --no-preserve-root /` попросят подтвердить удаление всех данных.

### Что такое образы и публичные образы

> Допустим, я разработал первую версию веб-сервиса и готовлюсь открыть ее для пользователей. В ВМ уже отлажено рабочее окружение для приложения, выверены настройки служб. Осталось ее реплицировать, чтобы сервис оставался доступен, даже при неполадках.

Можно развернуть ВМ из снимка диска или из образа. Образы и снимки созданные в одной зоне доступности , доступны и в других. 

В основном образы используют, чтобы быстро создать загрузочный диск ВМ. Оптимальны для распространения ПО, например дистрибутивов ОС или дисков с установленными программами. Сервис - это как раз диструбутив ОС с предустановленными и настроенными приложениями

Создание ВМ из образа происходит быстрее чем со снимка.

**Использование готового образа**

Это значит что можно создать ВМ с уже установленной ОС.

Так же можно выбрать образ с уже установленными приложениями (в Cloud Marketplace)

> например если сервис будет хранить данные в БД, то можно сразу создать ВМ с предустановленной Postgres Pro Enterprise Database, работающей поверх Debian.

**Перенос локальной вычислительной машины в Computer Cloud**

Для этого нужно подготовить файл образа ВМ (поддерживаются образы форматов Qcow2`, `VMDK` или `VHD) и загрузить его в бакет Yandex Object Storage, после чего он станет доступен при создании ВМ.

**Создание публичных образов**

Чтобы другие пользователи могли создавать ВМ и диски с помощью загруженного образа, нужно открыть к нему доступ, тогда он станет публичным. Делается не из консоли, а из интерфейса командной строки Yandex Cloud CLI.

1. [Установите и настройте](https://cloud.yandex.ru/docs/cli/quickstart) Yandex Cloud CLI.
2. В командной строке выполните команду:

```
yc resource-manager folders list 
```

Результат:

```
+----------------------+---------+--------+--------+
|          ID          |  NAME   | LABELS | STATUS |
+----------------------+---------+--------+--------+
| b1gdf1scqef5bpqrpo5j | default |        | ACTIVE |
+----------------------+---------+--------+-------- 
```

Скопируйте название каталога, где хранится образ. В примере это `default`.

1. Назначьте системной группе `allAuthenticatedUsers` роль `compute.images.user`:

```
yc resource-manager folder add-access-binding default \
  --role compute.images.user \
  --subject system:allAuthenticatedUsers 
```

Готово. Вы открыли всем аутентифицированным пользователям Yandex Cloud доступ к папке с образом.

Чтобы просмотреть список публичных образов, введите команду:

```
yc compute image list --folder-id standard-images 
```